window.cmt_mntn=window.cmt_mntn||{},function(n,r){var o,s=[];n.mentions=n.mentions||{},n.mentions.users=window.cmt_mntn.mentions.users||[],"object"==typeof window.BP_Suggestions&&(n.mentions.users=window.BP_Suggestions.friends||n.mentions.users),r.fn.cmt_mntn_mentions=function(t){r.isArray(t)&&(t={data:t});var n={delay:200,hideWithoutSuffix:!0,insertTpl:"@${user_login} ",limit:10,startWithSpace:!1,suffix:"",callbacks:{filter:function(t,n,e){for(var i,o=[],r=new RegExp("^"+t+"| "+t,"ig"),s=0,a=n.length;s<a;s++)(i=n[s])[e].toLowerCase().match(r)&&o.push(i);return o},highlighter:function(t,n){return n?(n=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+n.replace("+","\\+")+")([\\w ]*)\\s*<","ig"),t.replace(n,function(t,n,e,i){return">"+n+"<strong>"+e+"</strong>"+i+"<"})):t},before_reposition:function(t){var n,e=r("#atwho-ground-"+this.id+" .atwho-view"),i=r("body"),o=this.$inputor.data("atwho");"undefined"!==o&&"undefined"!==o.iframe&&null!==o.iframe?(n=this.$inputor.caret("offset",{iframe:o.iframe}),"undefined"!==(o=r(o.iframe).offset())&&(n.left+=o.left,n.top+=o.top)):n=this.$inputor.caret("offset"),o=n.left>i.width()/2?(e.addClass("right"),n.left-t.left-this.view.$el.width()):(e.removeClass("right"),n.left-t.left+1),i.width()<=400&&r(document).scrollTop(n.top-6),e=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10),t.top=n.top+(e=!e||e<5?19:e),t.left+=o},inserting_wrapper:function(t,n,e){return""+n+e}}},e={callbacks:{remoteFilter:function(n,e){var t=r(this),i={};"object"==typeof(o=s[n])?e(o):(t.xhr&&t.xhr.abort(),i={action:"cmt_mntn_get_users",term:n},r.isNumeric(this.$inputor.data("suggestions-group-id"))&&(i["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),t.xhr=r.getJSON(Comment_Mention.ajaxurl,i).done(function(t){t.success?(t=r.map(t.data,function(t){return t.search=t.search||t.user_login+" "+t.name,t}),s[n]=t,e(t)):r("#cmt-mntn-subscription-reminder").show()}))}},data:r.map(t.data,function(t){return t.search=t.search||t.name,t}),at:"@",searchKey:"search",displayTpl:Comment_Mention.mention_result_tlp},n=r.extend(!0,{},n,e,t);return r.fn.atwho.call(this,n)},r(document).ready(function(){r("#commentform textarea").cmt_mntn_mentions(n.mentions.users),r(".bbp-topic-form form textarea").cmt_mntn_mentions(n.mentions.users),r(".bbp-reply-form form textarea").cmt_mntn_mentions(n.mentions.users),window.onload=function(){function t(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&(r(window.tinyMCE.activeEditor.contentDocument.activeElement).cmt_mntn_mentions(n.mentions.users),window.clearInterval(my_timing))}my_timing=setInterval(function(){t()},500),t()}})}(cmt_mntn,jQuery);